<!doctype html>
<html>
<head>
<meta charset="utf-moveSpeed">
<title>Tic-A-Tac Poker</title>
<link rel="stylesheet" type="text/css" href="theme.css" media="all">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
<script src="constants.js"></script>
<script src="ai.js"></script>
<script src="card.js"></script>
<script src="class.js"></script>
<script src="handler.js"></script>
<script src="render.js"></script>
<script>
//Game resource///////////////////////////////////
image = new Image();
image.src = "image.png";
image.onload = init;

//////////////////////////////////////////////////
function init(){
	deck = new Deck();
	dealtCards = new Array();
	player = new Player("Eric",115);
	ai = new Player("AI",545);
	
	//Get canvas
	animation = $("#animation")[0].getContext && $("#animation")[0].getContext("2d");
	board = $("#board")[0].getContext && $("#board")[0].getContext("2d");
	surface = $("#surface")[0].getContext && $("#surface")[0].getContext("2d");
	
	//Add event handlers
	$("#surface").mousedown(mouseDownHandler);
	$("#surface").mousemove(mouseMoveHandler);
	$("#surface").mouseout(mouseOutHandler);
	$("#surface").mouseup(mouseUpHandler);
	
	playerTurn = true;
	
	gameLoop();
}

function gameLoop(){
	for (var i = 0; i < 6; i++)
		if (!dealtCards[i]) dealtCards[i] = deck.dealCard();
	
	if (!playerTurn) {
		//AI action	
		if (ai.move) {
			ai.decision = aiAction();
			
			focusCardIndex = ai.decision.focusCardIndex;
			dealtCards[focusCardIndex].posX = 210+focusCardIndex*90;
			dealtCards[focusCardIndex].posY = 520;
			dealtCards[focusCardIndex].scale = 1.1;
			
			ai.move = false;
		}
		
		//Moving the card
		var moveAngle = Math.abs(Math.atan((dealtCards[focusCardIndex].posY-ai.decision.destPos.y)/(dealtCards[focusCardIndex].posX-ai.decision.destPos.x)));
		var moveSpeed = 8;
		if (dealtCards[focusCardIndex].posX < ai.decision.destPos.x) dealtCards[focusCardIndex].posX += Math.floor(moveSpeed*Math.cos(moveAngle));
		if (dealtCards[focusCardIndex].posX > ai.decision.destPos.x) dealtCards[focusCardIndex].posX -= Math.floor(moveSpeed*Math.cos(moveAngle));
		if (dealtCards[focusCardIndex].posY < ai.decision.destPos.y) dealtCards[focusCardIndex].posY += Math.floor(moveSpeed*Math.sin(moveAngle));
		if (dealtCards[focusCardIndex].posY > ai.decision.destPos.y) dealtCards[focusCardIndex].posY -= Math.floor(moveSpeed*Math.sin(moveAngle));
		
		if (dealtCards[focusCardIndex].posX > ai.decision.destPos.x-moveSpeed && dealtCards[focusCardIndex].posX < ai.decision.destPos.x+moveSpeed &&
			dealtCards[focusCardIndex].posY > ai.decision.destPos.y-moveSpeed && dealtCards[focusCardIndex].posY < ai.decision.destPos.y+moveSpeed) {
			ai.updateGrid(ai.decision.destPos.pos,dealtCards[focusCardIndex]);
			dealtCards[focusCardIndex] = null;
			focusCardIndex = -1;
			
			ai.move = true;
			player.move = true;
			playerTurn = true;	
		}
	}
	
	renderBoard();
	renderSurface();
	setTimeout("gameLoop()",20);	
}
</script>
</head>

<body>
<div>
	<canvas id="board" width="960" height="640"></canvas>
    <canvas id="animation" width="960" height="640"></canvas>
	<canvas id="surface" width="960" height="640"></canvas>
</div>
</body>
</html>
